// Prisma Schema - BRAVOS BRASIL E-commerce
// Database: PostgreSQL

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float
  image       String?
  category    String
  sizes       String[] // Array de tamanhos disponíveis
  colors      String[] // Array de cores disponíveis
  stock       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  orderItems OrderItem[]

  @@map("products")
}

model Order {
  id           String      @id @default(cuid())
  total        Float
  status       OrderStatus @default(PENDING)
  mpPaymentId  String?     @map("mp_payment_id") // ID do pagamento no Mercado Pago
  mpStatus     String?     @map("mp_status") // Status do pagamento no MP
  payerName    String?     @map("payer_name")
  payerEmail   String      @map("payer_email")
  payerCpf     String?     @map("payer_cpf")
  payerPhone   String?     @map("payer_phone")
  paymentMethod String?    @map("payment_method") // "pix" ou "bolbradesco"
  pixQrCode    String?     @map("pix_qr_code") // QR Code do PIX
  pixCopyPaste String?     @map("pix_copy_paste") // Código copia e cola do PIX
  boletoUrl    String?     @map("boleto_url") // URL do boleto
  boletoBarcode String?    @map("boleto_barcode") // Código de barras do boleto
  externalReference String @unique @map("external_reference") // Referência externa única
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  items OrderItem[]

  @@map("orders")
}

model OrderItem {
  id         String  @id @default(cuid())
  orderId    String  @map("order_id")
  productId  String  @map("product_id")
  quantity   Int
  unitPrice  Float   @map("unit_price")
  size       String?
  color      String?
  createdAt  DateTime @default(now()) @map("created_at")

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

enum OrderStatus {
  PENDING
  PAID
  CANCELED
  FAILED
  REFUNDED
}
